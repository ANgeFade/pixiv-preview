# Pixiv 原图预览增强 - Chrome 扩展

🎨 一个强大的Chrome浏览器扩展，让你在Pixiv上鼠标悬停即可查看高清原图预览！

## ✨ 功能特性

- ✅ **自动识别缩略图** - 智能识别页面上的所有Pixiv缩略图
- ✅ **原图预览** - 鼠标悬停300ms即可显示高清原图
- ✅ **多页支持** - 支持多页作品的每一页预览
- ✅ **绕过防盗链** - 通过后台脚本设置正确的Referer，绕过Pixiv防盗链限制
- ✅ **智能缓存** - 自动缓存已加载的原图，提升响应速度
- ✅ **多格式尝试** - 自动尝试PNG、JPG、JPEG格式
- ✅ **精美UI** - 带有渐变边框和阴影效果的预览框

## 📦 安装方法

### 方式1：开发者模式加载（推荐）

1. **打开Chrome扩展管理页面**
   - 在地址栏输入：`chrome://extensions/`
   - 或点击菜单 → 更多工具 → 扩展程序

2. **启用开发者模式**
   - 打开页面右上角的"开发者模式"开关

3. **加载扩展**
   - 点击"加载已解压的扩展程序"
   - 选择 `f:\code_program\pixiv-preview\extension` 文件夹
   - 点击"选择文件夹"

4. **完成！**
   - 扩展图标会出现在工具栏
   - 访问 https://www.pixiv.net/ 即可使用

### 方式2：打包为.crx文件

1. 在扩展管理页面点击"打包扩展程序"
2. 选择 `extension` 文件夹
3. 生成 .crx 文件后拖拽到Chrome安装

## 🎯 使用方法

1. **访问Pixiv** - 打开 https://www.pixiv.net/
2. **浏览作品** - 正常浏览作品列表
3. **鼠标悬停** - 将鼠标悬停在任意缩略图上
4. **查看预览** - 等待300ms，原图预览自动显示
5. **移开鼠标** - 预览自动消失

## 📁 项目结构

```
extension/
├── manifest.json       # 扩展配置文件
├── background.js       # 后台脚本（处理请求头）
├── content.js          # 内容脚本（主要功能）
├── styles.css          # 样式文件
├── popup.html          # 弹出界面
├── popup.js            # 弹出界面脚本
└── icons/              # 图标文件夹
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

## 🔧 技术细节

### 核心技术

- **Manifest V3** - 使用最新的Chrome扩展规范
- **Content Scripts** - 注入到Pixiv页面执行
- **Background Service Worker** - 处理跨域请求和请求头修改
- **MutationObserver** - 监听DOM变化，处理动态加载的图片

### 工作原理

1. **图片识别**
   - 通过 `closest('a[href*="/artworks/"]')` 从父级链接提取作品ID
   - 从图片URL正则匹配提取作品ID和页码

2. **URL构建**
   ```javascript
   // 缩略图URL示例：
   https://i.pximg.net/c/360x360_70/img-master/img/2025/11/24/02/20/03/137823716_p0_square1200.jpg
   
   // 提取日期路径和作品信息，构建原图URL：
   https://i.pximg.net/img-original/img/2025/11/24/02/20/03/137823716_p0.png
   ```

3. **请求处理**
   - 后台脚本通过 `fetch` API获取图片
   - 自动添加 `Referer: https://www.pixiv.net/` 绕过防盗链
   - 返回Blob URL给内容脚本显示

4. **预览显示**
   - 固定定位的预览框
   - 智能定位避免超出屏幕
   - 平滑的淡入动画

## 🐛 调试

打开Pixiv页面后，按 `F12` 打开开发者工具，查看控制台输出：

```
🎨 Pixiv 原图预览增强扩展已加载
📌 找到作品: ID=137823716, Page=0
🔍 尝试格式: png
✅ 找到原图: https://i.pximg.net/...
💾 已缓存: 137823716_0
✨ Pixiv 原图预览增强扩展就绪！
```

## ⚙️ 配置选项

点击扩展图标可以：
- 查看当前状态
- 查看缓存数量
- 清除缓存

## 🔄 更新日志

### v1.0.0 (2025-11-25)
- ✨ 初始版本发布
- ✅ 支持原图预览
- ✅ 绕过防盗链
- ✅ 多格式尝试
- ✅ 智能缓存

## 📝 注意事项

1. **仅支持Chrome** - 基于Manifest V3，需要Chrome 88+
2. **需要开发者模式** - 未上架商店，需手动加载
3. **Pixiv登录** - 部分图片可能需要登录Pixiv账号
4. **网络要求** - 需要能正常访问 i.pximg.net

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

---

**享受高清预览吧！** 🎨✨
